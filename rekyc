package com.sbi.yono.document.batch.processor.rekyc;

import java.util.List;

import org.json.JSONException;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.Mockito;

import com.sbi.yono.document.batch.dto.RekycTriggerDto;

class RekycTriggerProcessorTest {

    private RekycTriggerAsyncService asyncService;
    private RekycTriggerProcessor processor;

    @BeforeEach
    void setUp() {
        asyncService = Mockito.mock(RekycTriggerAsyncService.class);
        processor = new RekycTriggerProcessor(asyncService);
    }

    @Test
    void process_shouldCallAsyncService_andReturnSameList() throws JSONException {
        List<RekycTriggerDto> inputList = List.of(new RekycTriggerDto());

        List<RekycTriggerDto> result = processor.process(inputList);

        Assertions.assertNotNull(result);
        Assertions.assertEquals(inputList, result);
        Mockito.verify(asyncService, Mockito.times(1))
               .sendEdmsReq(inputList);
    }

    @Test
    void process_withEmptyList_shouldStillCallAsyncService() throws JSONException {
        List<RekycTriggerDto> inputList = List.of();

        List<RekycTriggerDto> result = processor.process(inputList);

        Assertions.assertNotNull(result);
        Assertions.assertTrue(result.isEmpty());
        Mockito.verify(asyncService, Mockito.times(1))
               .sendEdmsReq(inputList);
    }

    @Test
    void process_withNullList_shouldPassNullToAsyncService() throws JSONException {
        List<RekycTriggerDto> result = processor.process(null);

        Assertions.assertNull(result);
        Mockito.verify(asyncService, Mockito.times(1))
               .sendEdmsReq(null);
    }

    @Test
    void process_shouldNotThrowException() {
        Assertions.assertDoesNotThrow(() -> processor.process(List.of()));
    }

    @Test
    void process_shouldInvokeAsyncExactlyOnce() throws JSONException {
        List<RekycTriggerDto> list = List.of(new RekycTriggerDto());

        processor.process(list);

        Mockito.verify(asyncService, Mockito.only())
               .sendEdmsReq(list);
    }
}










package com.sbi.yono.document.batch.processor.rekyc;

import java.util.List;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.Mockito;

import com.sbi.yono.document.batch.dto.RekycTriggerDto;
import com.sbi.yono.document.savingsaccount.edms.rekyctrigger.RekycTriggerSvc;

class RekycTriggerAsyncServiceTest {

    private RekycTriggerSvc rekycTriggerSvc;
    private RekycTriggerAsyncService asyncService;

    @BeforeEach
    void setUp() {
        rekycTriggerSvc = Mockito.mock(RekycTriggerSvc.class);
        asyncService = new RekycTriggerAsyncService(rekycTriggerSvc);
    }

    @Test
    void sendEdmsReq_shouldCallRekycTriggerService() {
        List<RekycTriggerDto> list = List.of(new RekycTriggerDto());

        asyncService.sendEdmsReq(list);

        Mockito.verify(rekycTriggerSvc, Mockito.times(1))
               .callRekycTrigger(list);
    }

    @Test
    void sendEdmsReq_withEmptyList_shouldStillInvokeService() {
        List<RekycTriggerDto> list = List.of();

        asyncService.sendEdmsReq(list);

        Mockito.verify(rekycTriggerSvc, Mockito.times(1))
               .callRekycTrigger(list);
    }

    @Test
    void sendEdmsReq_withNullList_shouldStillInvokeService() {
        asyncService.sendEdmsReq(null);

        Mockito.verify(rekycTriggerSvc, Mockito.times(1))
               .callRekycTrigger(null);
    }

    @Test
    void sendEdmsReq_shouldNotThrowException() {
        Assertions.assertDoesNotThrow(() ->
                asyncService.sendEdmsReq(List.of())
        );
    }

    @Test
    void sendEdmsReq_shouldCallServiceOnlyOnce() {
        List<RekycTriggerDto> list = List.of(new RekycTriggerDto());

        asyncService.sendEdmsReq(list);

        Mockito.verify(rekycTriggerSvc, Mockito.only())
               .callRekycTrigger(list);
    }
}

















package com.sbi.yono.document.batch.processor.rekyc;

import java.util.List;
import java.util.Objects;

import org.json.JSONException;
import org.springframework.batch.item.ItemProcessor;

import com.sbi.yono.document.batch.dto.EtbTriggerDto;
import com.sbi.yono.document.batch.dto.PhotoRetryDto;
import com.sbi.yono.document.batch.dto.RekycTriggerDto;
import com.tcs.techbone.logger.FLogger;

public class RekycTriggerProcessor implements ItemProcessor<List<RekycTriggerDto>, List<RekycTriggerDto>> {
	private static final String METHOD_STARTED = "Method Ended";

	private static final String CLASS_NAME = "ProductMasterProcessor";
	private static final String TIER_NAME = "Document";
	private static final String METHOD_ENDED = "Method Ended";

	private final RekycTriggerAsyncService etbTriggerAsyncService;

	public RekycTriggerProcessor(RekycTriggerAsyncService etbTriggerAsyncService) {
		this.etbTriggerAsyncService = etbTriggerAsyncService;
	}

	@Override
	public List<RekycTriggerDto> process(List<RekycTriggerDto> photoRetryDtoList) throws JSONException {
		String methodName = "process";
		FLogger.info(TIER_NAME, CLASS_NAME, methodName, METHOD_STARTED);
		
				etbTriggerAsyncService.sendEdmsReq(photoRetryDtoList);
		
		
		FLogger.info(TIER_NAME, CLASS_NAME, methodName, METHOD_ENDED);
		return photoRetryDtoList;
	}
}





package com.sbi.yono.document.batch.processor.rekyc;

import java.util.List;

import org.springframework.scheduling.annotation.Async;
import org.springframework.stereotype.Service;

import com.sbi.yono.document.batch.dto.EtbTriggerDto;
import com.sbi.yono.document.batch.dto.PhotoRetryDto;
import com.sbi.yono.document.batch.dto.RekycTriggerDto;
import com.sbi.yono.document.savingsaccount.edms.etbtrigger.EtbTriggers;
import com.sbi.yono.document.savingsaccount.edms.phototrigger.PhotoTriggerCall;
import com.sbi.yono.document.savingsaccount.edms.rekyctrigger.RekycTriggerSvc;
import com.tcs.techbone.logger.FLogger;

@Service
public class RekycTriggerAsyncService {
	private static final String METHOD_STARTED = "Method Ended";

	private static final String CLASS_NAME = "ProductMasterProcessor";
	private static final String TIER_NAME = "Document";
	private static final String METHOD_ENDED = "Method Ended";

	RekycTriggerSvc rekycTriggerSvc;

	public RekycTriggerAsyncService(RekycTriggerSvc rekycTriggerSvc ) {

		this.rekycTriggerSvc = rekycTriggerSvc;
	}

	@Async
	public void sendEdmsReq(List<RekycTriggerDto> rekycTriggerList) {
		String methodName = "sendEdmsReq";
		FLogger.info(TIER_NAME, CLASS_NAME, methodName, METHOD_STARTED);
		rekycTriggerSvc.callRekycTrigger(rekycTriggerList);
		
		FLogger.info(TIER_NAME, CLASS_NAME, methodName, METHOD_ENDED);

	}

}
